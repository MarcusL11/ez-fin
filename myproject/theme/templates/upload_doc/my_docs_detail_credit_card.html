{% extends "../dashboard/dashboard_base.html" %}
{% load static %}
{% load humanize %}
{% block main %}
<div class="my-10 flex-col min-h-screen">
  <!-- Breadcrumbs -->
  <div class="breadcrumbs text-sm">
    <ul>
      <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
      <li><a href="{% url 'my_docs' %}">My Docs</a></li>
      <li>{{ document.name }}</li>
    </ul>
  </div>

  <div class="mt-2 p-4">
    <section class="flex-col">
      <header class="my-2">
        <h1 class="text-2xl font-bold mb-6">Document Name: {{ document.name }}</h1>
        <p>Bank: {{ document.bank.name }}</p>
        <p>Document Type: {{ document.transaction_type.name }}</p>
        <p>Card Number: {{ document.credit_card_summary.card_number }}</p>
        <p>Date Uploaded: {{ document.date_uploaded }}</p>
        <p>New Balance: {{ document.balance_and_payment.new_balance|intcomma }}</p>
        <p>Minimum Payment: {{ document.balance_and_payment.minimum_payment|intcomma }}</p>
        <p>Payment Due Date: {{ document.balance_and_payment.payment_date }}</p>
      </header>             
    </section>

      <!-- TODO: Add URL for Save to Database -->
      <button 
        type="submit" 
        class="btn btn-primary" 
        hx-post=""
        hx-target=""
        hx-swap="innerHTML"
        hx-trigger="click"
        hx-vals='{"document_id":"{{ document.id }}"}'>
        Add to Database
      </button>
       <!--TODO: Add URL for saving category expensee -->
      <button 
        type="submit" 
        class="btn btn-primary" 
        hx-post=""
        hx-target=""
        hx-swap="innerHTML"
        hx-trigger="click"
        hx-vals=''>Save Category
      </button>
      <!-- TODO: Add AI functionality to categorize -->
      <button 
        type="submit" 
        class="btn btn-primary" 
        hx-post=""
        hx-target=""
        hx-swap="innerHTML"
        hx-trigger="click"
        hx-vals=''>
        Categorize with
        <img src="{% static 'svg/ai_icon.svg' %}" alt="">
      </button>


      <div class="overflow-x-auto">
        <table class="my-10 table table-xs">
          <thead>
            <tr>
              <th>#</th>
              <th>
                <!-- TODO: Add Hyperscript function to select all and deselect-->
                <label>
                  <input type="checkbox" class="checkbox checkbox-xs"
                  _="
                    on click
                      set .checkbox.checked to my.checked
                    end
                  "/>
                </label>
              </th>
              <th>Bank</th>
              <th>Transaction Type</th>
              <th>Transaction Date</th>
              <th>Description</th>
              <th>Amount</th>
              <th>Category</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for transaction in document.transaction_details.all %}
            <!-- TODO: Convert Table Row into a Reusable Component -->
            <tr id="transaction_row_{{ transaction.id}}">
              <td>{{ forloop.counter }}</td> 
              <td>
                {% if transaction.saved %}
                <input 
                  type="checkbox" 
                  class="checkbox checkbox-xs" 
                  disabled />
                {% else%}
                <input 
                  type="checkbox" 
                  class="checkbox checkbox-xs"
                  name="transaction_ids"
                  value="{{ transaction.id }}"
                  _="
                  on load 
                  set my.checked to false
                  end 
                  "/>
                {% endif %}
              </td>
              <td>{{ document.bank.name }}</td>
              <td>{{ document.transaction_type.name }}</td>
              <td>{{ transaction.transaction_date }}</td>
              <td>{{ transaction.description }}</td>
              <td>{{ transaction.amount|intcomma }}</td>

              {% if transaction.expense_category.name %}
              <td>{{ transaction.expense_category.name }}</td>
              <!--TODO: Add HTMX function to edit category -->
              <td>
                <div 
                  class="btn btn-ghost"
                  hx-post="{% url 'edit_category' %}"
                  hx-target="#transaction_row_{{ transaction.id }}"
                  hx-swap="outerHTML"
                  hx-trigger="click"
                  hx-vals='{
                    "transaction_id":"{{ transaction.id }}",
                    "counter_loop":"{{ forloop.counter }}"
                  }'>
                    <img src="{% static 'svg/edit_icon.svg' %}" alt="">
                </div>
              </td>
              {% else %}
              <td>
                <div class="data_inputs_{{ transaction.id }}">
                  <input 
                    type="text" 
                    name="transaction_category"
                    placeholder="Type here" 
                    class="input input-bordered w-full max-w-xs"/>
                  <input 
                    type="hidden" 
                    name="transaction_id" 
                    value="{{ transaction.id }}"/>
                  <input 
                    type="hidden" 
                    name="counter_loop" 
                    value="{{ forloop.counter }}"/>
                </div>
              </td>
              <td>
                <div
                  class="btn btn-ghost"
                  hx-post="{% url 'save_category' %}"
                  hx-target="#transaction_row_{{ transaction.id }}"
                  hx-swap="outerHTML"
                  hx-trigger="click"
                  hx-include=".data_inputs_{{ transaction.id }} input">
                  <img src="{% static 'svg/save_icon.svg' %}">
                </div>
              </td>
              {% endif %}

            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    <div class="flex space-x-1">
      <!--TODO: Add URL for function to copy -->
      <a href="" class="block py-2.5 rounded">         
        <button class="btn btn-primary">Copy Table
        </button>
      </a>
      <!--TODO: Add URL for Document Download CSV -->
      <a href="" class="block py-2.5 rounded">         
        <button class="btn btn-primary">Download
          <img src="{% static 'svg/csv_icon.svg' %}" alt="">
        </button>
      </a> 
    </div>
  </div>
</div>

{% endblock %}
